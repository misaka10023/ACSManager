{% extends "base.html" %}
{% block content %}
<div class="card" data-page="config">
  <div class="card-title flex items-center justify-between">
    <span>配置编辑</span>
    <div class="space-x-2">
      <button id="cfg-load" class="btn btn-secondary">重新载入</button>
      <button id="cfg-save" class="btn btn-primary">保存配置</button>
    </div>
  </div>
  <div class="text-xs text-slate-600 mb-4 space-y-1">
    <div><span class="font-semibold">提示：</span>所有配置均为 UTF-8；root_path 与反代前缀保持一致；使用 password_hash 时请清空 password。</div>
    <div><span class="font-semibold">转发格式：</span><code>本地:远端</code> 或 <code>本地:远端:中间端口</code>（double 必填中间端口）。每行一条，或用逗号分隔。</div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
    <div class="space-y-4">
      <div class="subcard">
        <div class="subcard-title flex items-center justify-between">
          <span>全局 ACS</span>
          <span class="text-[11px] text-slate-500">登录 / 公钥 / Cookies</span>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <div class="space-y-1">
            <div class="text-[11px] text-slate-500">Base URL（含协议/端口）</div>
            <input id="acs-base-url" type="text" class="input" placeholder="http://192.168.10.200:6080">
          </div>
          <div class="space-y-1">
            <div class="text-[11px] text-slate-500">API 前缀</div>
            <input id="acs-api-prefix" type="text" class="input" placeholder="/sothisai">
          </div>
          <div class="space-y-1">
            <div class="text-[11px] text-slate-500">登录用户</div>
            <input id="acs-login-user" type="text" class="input" placeholder="必填">
          </div>
          <div class="space-y-1">
            <div class="text-[11px] text-slate-500">登录密码</div>
            <input id="acs-login-password" type="text" class="input" placeholder="必填">
          </div>
          <div class="space-y-1">
            <div class="text-[11px] text-slate-500">用户类型</div>
            <input id="acs-user-type" type="text" class="input" placeholder="os">
          </div>
          <div class="space-y-1">
            <div class="text-[11px] text-slate-500">公钥(Base64)</div>
            <input id="acs-public-key" type="text" class="input" placeholder="可选，用于加密密码">
          </div>
          <div class="flex items-center gap-2">
            <input id="acs-verify-ssl" type="checkbox" class="checkbox"><span class="text-[11px] text-slate-600">验证 SSL</span>
          </div>
          <div class="space-y-1">
            <div class="text-[11px] text-slate-500">JSESSIONID（可选）</div>
            <input id="acs-cookie-jsessionid" type="text" class="input" placeholder="可空">
          </div>
          <div class="space-y-1">
            <div class="text-[11px] text-slate-500">GV_JSESSIONID（可选）</div>
            <input id="acs-cookie-gv" type="text" class="input" placeholder="可空">
          </div>
        </div>
      </div>

      <div class="subcard">
        <div class="subcard-title flex items-center justify-between">
          <span>Web UI</span>
          <span class="text-[11px] text-slate-500">访问 / 认证</span>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
          <div class="space-y-1">
            <div class="text-[11px] text-slate-500">Host</div>
            <input id="webui-host" type="text" class="input" placeholder="0.0.0.0">
          </div>
          <div class="space-y-1">
            <div class="text-[11px] text-slate-500">Port</div>
            <input id="webui-port" type="number" class="input" placeholder="8000">
          </div>
          <div class="space-y-1">
            <div class="text-[11px] text-slate-500">Root Path</div>
            <input id="webui-root-path" type="text" class="input" placeholder="/acsmanager">
          </div>
        </div>
        <div class="mt-3 space-y-2">
          <div class="text-sm font-semibold">认证</div>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
            <label class="flex items-center gap-2"><input id="auth-enabled" type="checkbox" class="checkbox"><span class="text-[11px] text-slate-600">启用登录</span></label>
            <div class="space-y-1">
              <div class="text-[11px] text-slate-500">用户名</div>
              <input id="auth-username" type="text" class="input" placeholder="admin">
            </div>
            <div class="space-y-1">
              <div class="text-[11px] text-slate-500">密码</div>
              <input id="auth-password" type="text" class="input" placeholder="change-me">
            </div>
            <div class="space-y-1">
              <div class="text-[11px] text-slate-500">密码哈希</div>
              <input id="auth-password-hash" type="text" class="input" placeholder="sha256">
            </div>
            <div class="space-y-1">
              <div class="text-[11px] text-slate-500">Secret Key</div>
              <input id="auth-secret-key" type="text" class="input" placeholder="change-me-please">
            </div>
            <div class="space-y-1">
              <div class="text-[11px] text-slate-500">Session TTL(秒)</div>
              <input id="auth-session-ttl" type="number" class="input" placeholder="43200">
            </div>
          </div>
        </div>
      </div>

      <div class="subcard">
        <div class="subcard-title">日志</div>
        <div class="form-grid">
          <label>Level<input id="log-level" type="text" class="input" placeholder="INFO"></label>
        </div>
      </div>
    </div>

    <div class="space-y-4">
      <div class="subcard">
        <div class="subcard-title flex items-center justify-between">
          <span>容器列表</span>
          <button id="container-add" class="btn btn-secondary btn-xxs">添加容器</button>
        </div>
        <p class="text-xs text-slate-500 mb-2">容器名、ACS 容器名必填；转发端口按行填写本地/容器/中间端口。</p>
        <div id="container-form-list" class="space-y-3"></div>
      </div>

      <div class="subcard">
        <div class="subcard-title">示例模板（settings.example.yaml）</div>
        <pre class="code-block h-64 overflow-y-auto text-xs whitespace-pre-wrap">{{ config_template or "未能读取示例模板" }}</pre>
      </div>
    </div>
  </div>

  <div id="cfg-status" class="text-sm text-slate-600 mt-2"></div>
</div>
{% endblock %}
